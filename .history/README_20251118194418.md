# ðŸš— Smart Driver Hub - Drowsiness Detection System

[![Python](https://img.shields.io/badge/Python-3.7%2B-blue.svg)](https://www.python.org/)
[![OpenCV](https://img.shields.io/badge/OpenCV-4.x-green.svg)](https://opencv.org/)
[![Flask](https://img.shields.io/badge/Flask-2.x-lightgrey.svg)](https://flask.palletsprojects.com/)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

A comprehensive real-time drowsiness detection system that monitors driver alertness using computer vision and machine learning. The system tracks eye closure patterns and triggers audio-visual alerts when drowsiness is detected, helping prevent accidents caused by driver fatigue.

> **Perfect for:** Road safety projects, driver monitoring systems, fleet management, autonomous vehicle research, and educational purposes.

## âœ¨ Features

### Core Detection
- ðŸ‘ï¸ **Real-time Eye Tracking** - Uses OpenCV Haar Cascade classifiers for accurate eye detection
- â±ï¸ **Customizable Alert Threshold** - Set drowsiness detection time (3-10 seconds, default: 5s)
- ðŸ”Š **Audio Alerts** - Loud alarm sound using Pygame to wake drowsy drivers
- ðŸ“Š **Live Status Display** - Real-time timer showing eye closure duration
- ðŸŽ¥ **Video Feed Overlay** - Visual rectangles highlighting detected faces and eyes

### Two Deployment Options
1. **ðŸ–¥ï¸ Standalone Desktop App** - Quick Python script with OpenCV window
2. **ðŸŒ Web Application** - Modern responsive UI with Flask backend and REST API

### Additional Features
- âš™ï¸ **Adjustable Settings** - Configure volume, threshold, and sound preferences
- ðŸŽ¨ **Professional UI** - Clean, intuitive interface with smooth animations
- ðŸ”§ **Easy Setup** - No complex dependencies or model downloads required
- ðŸš€ **Fuel Efficiency Predictor** - Demo vehicle efficiency calculator with sample datasets
- ðŸ“± **Cross-Platform** - Works on Windows, macOS, and Linux

## ðŸ“‹ Table of Contents
- [Quick Start](#-quick-start)
- [Installation](#-installation)
- [Usage](#-usage)
  - [Standalone Desktop App](#1-standalone-desktop-app)
  - [Web Application](#2-web-application)
- [Project Structure](#-project-structure)
- [Configuration](#-configuration)
- [Troubleshooting](#-troubleshooting)
- [How It Works](#-how-it-works)
- [Contributing](#-contributing)
- [Roadmap](#-roadmap)
- [License](#-license)

## ðŸš€ Quick Start

```bash
# Clone the repository
git clone https://github.com/shravanramakunja/drowsy-detector.git
cd drowsy-detector

# Install dependencies
pip install -r requirements.txt

# Run standalone app
python drowsiness.py

# OR run web version
python app.py
# Then open http://localhost:5000
```

## ðŸ“¦ Installation

---

## Installation

### Prerequisites

- **Python 3.7+** (Python 3.12 recommended)
- **Webcam** (built-in or USB)
- **Operating System**: Windows, macOS, or Linux
- **Internet connection** (for initial package installation only)

### Step 1: Clone the Repository

```bash
# Using Git
git clone https://github.com/shravanramakunja/drowsy-detector.git
cd drowsy-detector

# Or download ZIP and extract
# Then navigate to the extracted folder
```

### Step 2: Create Virtual Environment (Recommended)

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# macOS/Linux
python3 -m venv venv
source venv/bin/activate
```

### Step 3: Install Dependencies

```bash
pip install -r requirements.txt
```

**Dependencies installed:**

- `opencv-python` - Computer vision and face/eye detection
- `numpy` - Numerical operations and array handling
- `pygame` - Audio playback for alarm sounds
- `flask` - Web server framework
- `flask-cors` - Cross-origin resource sharing support

**Troubleshooting installation:**

```bash
# Upgrade pip first
python -m pip install --upgrade pip

# Install with verbose output
pip install -r requirements.txt --verbose

# Or install packages individually
pip install opencv-python numpy pygame flask flask-cors
```

---

## ðŸŽ¯ Usage

### 1. Standalone Desktop App

Opens a desktop window with live camera feed and detection.

**Steps:**

1. **Run the script:**

   ```bash
   python drowsiness.py
   ```

2. **What happens:**
   - Camera window opens showing live feed
   - Blue rectangle highlights detected face
   - Green rectangles show detected eyes (when open)
   - Status displayed at bottom: Active/ALERT and timer

3. **Test drowsiness detection:**
   - Close your eyes for 5+ seconds
   - Alarm sounds automatically
   - Red "DROWSINESS ALERT!" text appears
   - Open eyes to stop alarm

4. **Exit:** Press `q` or `t` key

**Keyboard Shortcuts:**

| Key | Action |
|-----|--------|
| `q` | Quit application |
| `t` | Quit application |

### 2. Web Application

Modern browser-based interface with enhanced UI/UX.

**Steps:**

1. **Start the Flask server:**

   ```bash
   python app.py
   ```

   You'll see:

   ```text
   ============================================================
   Smart Driver Hub - Drowsiness Detection Backend
   ============================================================
   [INFO] Access the web interface at: http://localhost:5000
   * Running on http://0.0.0.0:5000
   ```

2. **Open your browser:**

   Navigate to [http://localhost:5000](http://localhost:5000)

3. **Use the interface:**
   - Scroll to "Start Drowsiness Detection" section
   - Adjust settings (threshold, volume, sound toggle)
   - Click **"Start Detection"** button
   - Video feed appears with detection overlay
   - Status panel shows real-time updates

4. **Test the system:**
   - Close eyes and watch timer count up
   - Alert triggers at threshold (default 5s)
   - Red alert box appears, alarm sounds

5. **Stop:** Click **"Stop Detection"** button

6. **Shutdown:** Press `Ctrl+C` in terminal to stop server

**Bonus Feature - Fuel Efficiency Predictor:**

- Click "Predict Fuel Efficiency" in Features section
- Select sample dataset or enter custom vehicle data
- View estimated fuel efficiency (km/l) for city/highway

---

## Troubleshooting

### Camera Not Working

**Problem**: "Could not open webcam" or "Failed to grab frame"

**Solutions**:
1. **Check camera permissions**: 
   - Windows: Settings > Privacy > Camera > Allow apps to access camera
   - Make sure Python is allowed
2. **Close other camera apps**: 
   - Skype, Zoom, Teams, Discord
   - Only one app can use camera at a time
3. **Try different camera index**:
   - Edit the code to try camera 0, 1, or 2
4. **Restart your computer**: Sometimes helps reset camera drivers

### Module Not Found Errors

**Problem**: `ModuleNotFoundError: No module named 'opencv'` or similar

**Solution**:
```bash
# Reinstall all dependencies
pip uninstall opencv-python numpy pygame flask flask-cors
pip install -r requirements.txt

# Or install individually
pip install opencv-python
pip install numpy
pip install pygame
pip install flask flask-cors
```

### No Sound/Alarm

**Problem**: Alarm doesn't play when eyes are closed

**Solutions**:
1. **Check system volume**: Make sure it's not muted
2. **Check Python volume**: 
   - Windows: Volume Mixer > Python
3. **Web version**: 
   - Check "Enable Sound Alerts" checkbox is enabled
   - Adjust "Alarm Volume" slider
4. **Test speakers**: Play music to verify speakers work

### Web Application: Can't Connect to Backend

**Problem**: "Unable to connect to backend server"

**Solutions**:
1. **Verify server is running**: 
   - Check terminal shows "Running on http://0.0.0.0:5000"
2. **Check correct URL**: Use `http://localhost:5000` not `https://`
3. **Firewall**: May need to allow Python through firewall
4. **Port conflict**: Another app might be using port 5000
   - Edit `app.py` line with `port=5000` to use different port

### Eyes Not Detected

**Problem**: System doesn't detect eyes even when open

**Solutions**:
1. **Improve lighting**: Face should be well-lit
2. **Remove glasses**: Can interfere with detection
3. **Position face**: Look directly at camera, not at angle
4. **Camera distance**: Sit 1-3 feet from camera
5. **Clean camera lens**: Remove any smudges

### Detection Too Sensitive or Not Sensitive Enough

**Solution**: Adjust the threshold

**Standalone version**: Edit `drowsiness.py` line:
```python
self.EYE_CLOSED_SECONDS = 5  # Change to 3-10 seconds
```

**Web version**: Use the slider in the settings panel (3-10 seconds)

---

## How It Works

### Detection Algorithm

1. **Face Detection**: Uses Haar Cascade classifier to find faces
2. **Eye Detection**: Searches upper half of face for eyes
3. **Eye State Monitoring**: 
   - If 2+ eyes detected â†’ Eyes are OPEN
   - If <2 eyes detected â†’ Eyes are CLOSED
4. **Timer Tracking**: Measures how long eyes stay closed
5. **Alert Triggering**: If closed > threshold â†’ Alarm sounds

### Technical Stack

- **Python 3.12**: Programming language
- **OpenCV**: Computer vision library for face/eye detection
- **NumPy**: Numerical operations
- **Pygame**: Audio playback for alarm
- **Flask**: Web server framework (web version)
- **HTML/CSS/JavaScript**: Frontend interface (web version)

### File Structure

```
drowsiness/
â”œâ”€â”€ drowsiness.py          # Standalone desktop application
â”œâ”€â”€ app.py                 # Flask backend server
â”œâ”€â”€ requirements.txt       # Python dependencies
â”œâ”€â”€ README.md             # This file
â””â”€â”€ web/                  # Web interface files
    â”œâ”€â”€ index.html        # Main HTML page
    â”œâ”€â”€ styles.css        # Styling
    â”œâ”€â”€ script.js         # Frontend JavaScript
    â””â”€â”€ README.md         # Web-specific docs
```

---

## Parameters

### Adjustable Settings

| Parameter | Default | Range | Description |
|-----------|---------|-------|-------------|
| `EYE_CLOSED_SECONDS` | 5 | 3-10 | Seconds before alarm triggers |
| Alarm Volume | 80% | 0-100% | Loudness of alarm sound |
| Sound Enable | On | On/Off | Enable/disable audio alerts |

### Keyboard Shortcuts (Standalone)

| Key | Action |
|-----|--------|
| `q` | Quit application |
| `t` | Quit application |

---

## Requirements

- Python 3.7+
- Webcam
- Good lighting conditions
- Clear view of face

---

## Credits

Built for Smart Driver Hub Drowsiness Detection System


## Troubleshooting

**Error: Could not open webcam**
- Check if camera is connected
- Ensure no other application is using the camera

**Error: shape_predictor file not found**
- Download the predictor file as mentioned in installation steps

**Low detection accuracy**
- Improve lighting conditions
- Adjust camera position for clear face view
- Try adjusting `EAR_THRESHOLD` value

## Credits

Based on the Eye Aspect Ratio method for drowsiness detection.
